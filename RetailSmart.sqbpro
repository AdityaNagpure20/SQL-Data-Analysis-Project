<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="RetailSmart.db" readonly="0" foreign_keys="0" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="100"/><column_width id="3" width="1898"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><table title="customers" custom_title="0" dock_id="7" table="4,9:maincustomers"/><dock_state state="000000ff00000000fd00000001000000020000033b0000021efc0100000003fc000000000000033b0000000000fffffffa000000000100000005fb000000160064006f0063006b00420072006f00770073006500310000000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f00770073006500320000000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f00770073006500330100000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f00770073006500340000000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f00770073006500350000000000ffffffff0000000000000000fb000000160064006f0063006b00420072006f007700730065003601000000000000033b0000000000000000fb000000160064006f0063006b00420072006f007700730065003701000000000000033b0000013300ffffff000002580000000000000004000000040000000800000008fc00000000"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="customers" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_" freeze_columns="0"><sort/><column_widths><column index="1" value="257"/><column index="2" value="257"/><column index="3" value="156"/><column index="4" value="202"/><column index="5" value="95"/><column index="6" value="77"/><column index="7" value="72"/><column index="8" value="156"/><column index="9" value="133"/><column index="10" value="68"/><column index="11" value="39"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1*">SELECT customer_id, total_spent
FROM customers
ORDER BY total_spent DESC
LIMIT 10;

SELECT category_english,
SUM(total_price) AS total_revenue
FROM sales
GROUP BY category_english
ORDER BY total_revenue DESC
LIMIT 5;

SELECT c.city,
AVG(s.total_price) AS avg_order_value
FROM sales s
JOIN customers c ON s.customer_id = c.customer_id
GROUP BY c.city;

SELECT(SUM(CASE WHEN churn_flag = 1 THEN 1 ELSE 0 END) * 100.0) / COUNT(*) 
AS churn_percentage
FROM customers;

SELECT channel,
AVG(response_rate) AS avg_response_rate
FROM marketing
GROUP BY channel;

-- Missing category
SELECT COUNT(*) FROM sales WHERE category_english IS NULL;

-- Missing payment type
SELECT COUNT(*) FROM sales WHERE payment_type IS NULL;

-- Missing review score
SELECT COUNT(*) FROM reviews WHERE review_score IS NULL;

-- Missing recency
SELECT COUNT(*) FROM customers WHERE days_since_last_order IS NULL;

-- Extreme prices
SELECT * FROM sales
WHERE price &lt; 0 OR price &gt; 100000;

-- Extreme total_price
SELECT * FROM sales
WHERE total_price &lt; price;

-- Marketing spend outliers
SELECT * FROM marketing
WHERE spend &lt; 0 OR spend &gt; 100000;

-- Replace missing category
UPDATE sales SET category_english = 'Unknown'
WHERE category_english IS NULL;

-- Replace missing payment type
UPDATE sales SET payment_type = 'Unknown'
WHERE payment_type IS NULL;

-- Replace missing review score with average
UPDATE reviews
SET review_score = (SELECT ROUND(AVG(review_score))FROM reviews
WHERE review_score IS NOT NULL
)
WHERE review_score IS NULL;

-- Replace missing days_since_last_order with max value
UPDATE customers
SET days_since_last_order = (SELECT MAX(days_since_last_order)FROM customers
)
WHERE days_since_last_order IS NULL;

-- Standardize city names
UPDATE customers
SET city = UPPER(SUBSTR(city,1,1)) || LOWER(SUBSTR(city,2));

-- Standardize marketing channels
UPDATE marketing
SET channel = LOWER(channel);

-- Create derived date table
CREATE TABLE sales_dates AS
SELECT *,
DATE(order_purchase_timestamp) AS order_date,
STRFTIME('%Y', order_purchase_timestamp) AS order_year,
STRFTIME('%m', order_purchase_timestamp) AS order_month,
STRFTIME('%w', order_purchase_timestamp) AS order_weekday
FROM sales;

-- Sales without valid customers
SELECT s.* FROM sales s
LEFT JOIN customers c ON s.customer_id = c.customer_id
WHERE c.customer_id IS NULL;

-- Sales without valid products
SELECT s.* FROM sales s
LEFT JOIN products p ON s.product_id = p.product_id
WHERE p.product_id IS NULL;

CREATE TABLE rfm AS
SELECT customer_id,
MAX(julianday('now') - julianday(order_purchase_timestamp)) AS recency,
COUNT(order_id) AS frequency,
SUM(total_price) AS monetary
FROM sales
GROUP BY customer_id;

CREATE TABLE rfm_churn AS
SELECT r.*,c.churn_flag
FROM rfm r
JOIN customers c ON r.customer_id = c.customer_id;

-- Response rate &amp; spend by channel
SELECT channel,
AVG(response_rate) AS avg_response_rate,
AVG(spend) AS avg_spend
FROM marketing
GROUP BY channel;

-- Spend band analysis
SELECT
CASE
WHEN spend &lt; 2000 THEN '0-2K'
WHEN spend &lt; 4000 THEN '2-4K'
WHEN spend &lt; 6000 THEN '4-6K'
WHEN spend &lt; 8000 THEN '6-8K'
ELSE '8K+'
END AS spend_band,AVG(response_rate) AS avg_response_rate
FROM marketing
GROUP BY spend_band
ORDER BY spend_band;

</sql><current_tab id="0"/></tab_sql></sqlb_project>
